# 호스팅 및 배포 가이드 (PlayMCP용)

## 1. PlayMCP 호스팅 요구사항

| 요구사항 | 필수 여부 | 설명 |
|----------|----------|------|
| 도메인 | **필수** | IP 주소 등록 불가 |
| HTTPS | **필수** | SSL 인증서 필요 |
| 24시간 가동 | 권장 | 서비스 안정성 |
| 빠른 응답 | 권장 | 30초 이내 |

---

## 2. 호스팅 플랫폼 비교

### 2.1 Vercel (추천)

| 항목 | 내용 |
|------|------|
| 무료 티어 | ✅ 충분함 |
| 도메인 | `xxx.vercel.app` 무료 제공 |
| HTTPS | 자동 |
| 배포 | GitHub 연동 자동 배포 |
| 서버리스 | Edge Functions / Serverless Functions |

**장점:**
- 설정 간단
- 무료 도메인 제공
- 자동 HTTPS
- GitHub 푸시 시 자동 배포

**단점:**
- 서버리스라 Cold Start 있음
- 실행 시간 제한 (10초 ~ 60초)

### 2.2 Railway

| 항목 | 내용 |
|------|------|
| 무료 티어 | ✅ 월 $5 크레딧 |
| 도메인 | `xxx.railway.app` 무료 제공 |
| HTTPS | 자동 |
| 배포 | GitHub 연동 자동 배포 |
| Docker | 지원 |

**장점:**
- Docker 지원으로 유연함
- 항상 실행 상태 유지 가능
- 데이터베이스 쉽게 추가

**단점:**
- 무료 크레딧 소진 시 유료

### 2.3 Render

| 항목 | 내용 |
|------|------|
| 무료 티어 | ✅ 있음 (제한적) |
| 도메인 | `xxx.onrender.com` 무료 제공 |
| HTTPS | 자동 |
| 배포 | GitHub 연동 |

**장점:**
- 무료 티어 제공
- 설정 간단

**단점:**
- 무료 티어는 15분 비활성 시 Sleep
- Cold Start 느림

### 2.4 Fly.io

| 항목 | 내용 |
|------|------|
| 무료 티어 | ✅ 있음 |
| 도메인 | `xxx.fly.dev` 무료 제공 |
| HTTPS | 자동 |
| 글로벌 | 전 세계 엣지 배포 |

**장점:**
- 글로벌 배포로 빠른 응답
- Docker 지원

**단점:**
- 설정이 조금 복잡

### 플랫폼 선택 가이드

| 상황 | 추천 플랫폼 |
|------|------------|
| 빠르게 시작 | **Vercel** |
| 안정적 운영 | **Railway** |
| 비용 최소화 | **Render** (주의: Sleep) |
| 글로벌 서비스 | **Fly.io** |

---

## 3. Vercel 배포 가이드 (Python)

### 3.1 프로젝트 구조
```
my-mcp-server/
├── api/
│   └── mcp.py          # MCP 엔드포인트
├── requirements.txt
└── vercel.json
```

### 3.2 vercel.json
```json
{
  "version": 2,
  "builds": [
    {
      "src": "api/mcp.py",
      "use": "@vercel/python"
    }
  ],
  "routes": [
    {
      "src": "/mcp",
      "dest": "/api/mcp.py"
    }
  ]
}
```

### 3.3 api/mcp.py
```python
from http.server import BaseHTTPRequestHandler
import json

class handler(BaseHTTPRequestHandler):
    def do_POST(self):
        content_length = int(self.headers['Content-Length'])
        body = json.loads(self.rfile.read(content_length))

        method = body.get("method")
        request_id = body.get("id")

        if method == "initialize":
            response = {
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "protocolVersion": "2024-11-05",
                    "capabilities": {"tools": {}},
                    "serverInfo": {"name": "MyMCP", "version": "1.0.0"}
                }
            }
        elif method == "tools/list":
            response = {
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "tools": [
                        {
                            "name": "send_message",
                            "description": "메시지를 전송합니다",
                            "inputSchema": {
                                "type": "object",
                                "properties": {
                                    "message": {"type": "string"}
                                },
                                "required": ["message"]
                            }
                        }
                    ]
                }
            }
        elif method == "tools/call":
            response = {
                "jsonrpc": "2.0",
                "id": request_id,
                "result": {
                    "content": [{"type": "text", "text": "성공!"}]
                }
            }
        else:
            response = {
                "jsonrpc": "2.0",
                "id": request_id,
                "error": {"code": -32601, "message": "Method not found"}
            }

        self.send_response(200)
        self.send_header('Content-Type', 'application/json')
        self.end_headers()
        self.wfile.write(json.dumps(response).encode())
```

### 3.4 requirements.txt
```
# 필요한 패키지 추가
requests>=2.28.0
```

### 3.5 배포 명령어
```bash
# Vercel CLI 설치
npm i -g vercel

# 로그인
vercel login

# 배포
vercel --prod
```

### 3.6 결과
```
✅ https://my-mcp-server.vercel.app/mcp
```

---

## 4. Railway 배포 가이드 (Python)

### 4.1 프로젝트 구조
```
my-mcp-server/
├── main.py             # FastAPI 서버
├── requirements.txt
├── Procfile
└── railway.json
```

### 4.2 main.py
```python
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse
import uvicorn
import os

app = FastAPI()

@app.post("/mcp")
async def mcp_handler(request: Request):
    body = await request.json()
    # ... MCP 로직 (02_MCP_서버_개발_스펙.md 참조)
    pass

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 8000))
    uvicorn.run(app, host="0.0.0.0", port=port)
```

### 4.3 requirements.txt
```
fastapi>=0.100.0
uvicorn>=0.23.0
requests>=2.28.0
```

### 4.4 Procfile
```
web: uvicorn main:app --host 0.0.0.0 --port $PORT
```

### 4.5 배포
1. GitHub에 푸시
2. Railway 대시보드에서 "New Project"
3. GitHub 레포 선택
4. 자동 배포!

### 4.6 결과
```
✅ https://my-mcp-server.up.railway.app/mcp
```

---

## 5. 환경 변수 관리

### 민감 정보 (절대 코드에 하드코딩 금지!)
- 카카오 API 키
- OAuth Client Secret
- 데이터베이스 비밀번호

### Vercel 환경 변수 설정
```bash
vercel env add KAKAO_API_KEY
```

### Railway 환경 변수 설정
- 대시보드 → Variables → Add Variable

### 코드에서 사용
```python
import os

KAKAO_API_KEY = os.environ.get("KAKAO_API_KEY")
```

---

## 6. 도메인 설정

### 무료 도메인 (기본 제공)
| 플랫폼 | 도메인 형식 |
|--------|------------|
| Vercel | `xxx.vercel.app` |
| Railway | `xxx.up.railway.app` |
| Render | `xxx.onrender.com` |
| Fly.io | `xxx.fly.dev` |

### 커스텀 도메인 연결 (선택)
1. 도메인 구매 (가비아, Namecheap 등)
2. DNS 설정 (CNAME 레코드)
3. 플랫폼에서 도메인 추가
4. SSL 자동 발급

---

## 7. 모니터링 및 로깅

### 기본 로깅
```python
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

@app.post("/mcp")
async def mcp_handler(request: Request):
    body = await request.json()
    logger.info(f"Request: {body.get('method')}")
    # ...
```

### 헬스체크 엔드포인트
```python
@app.get("/health")
async def health_check():
    return {"status": "ok"}
```

### 외부 모니터링 서비스
- UptimeRobot (무료)
- Better Stack
- Datadog

---

## 8. 공모전 1등을 위한 배포 체크리스트

### 필수
- [ ] HTTPS 도메인으로 배포
- [ ] 모든 MCP 메서드 정상 동작
- [ ] 에러 핸들링 완료
- [ ] 환경 변수로 민감 정보 관리

### 권장
- [ ] 헬스체크 엔드포인트 추가
- [ ] 로깅 구현
- [ ] 응답 시간 30초 이내
- [ ] Cold Start 최소화 (Keep-alive)

### 선택
- [ ] 커스텀 도메인
- [ ] 모니터링 서비스 연동
- [ ] 자동 알림 설정

---

## 9. 빠른 시작 요약

```bash
# 1. Vercel CLI 설치
npm i -g vercel

# 2. 프로젝트 생성
mkdir my-mcp && cd my-mcp

# 3. 코드 작성 (위 예제 참조)

# 4. 배포
vercel --prod

# 5. PlayMCP에 등록
# URL: https://my-mcp.vercel.app/mcp
```

---

## 10. 다음 단계

1. MCP 서버 코드 작성 → `src/` 폴더
2. 로컬 테스트
3. 배포
4. PlayMCP 등록
5. 심사 통과
6. 공모전 응모!
http://pf.kakao.com/_IHxegn/chat